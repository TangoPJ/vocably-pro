<header class="header">
  <div class="header-items display-flex align-items-center">
    <ng-container *ngIf="isLoggedIn !== null">
      <div
        class="flex-1 display-md-block"
        [class.display-none]="dense && title"
      >
        <a [routerLink]="['/']"><app-logo class="logo-image"></app-logo></a>
      </div>
      <div
        class="flex-1 mat-title m-0 text-md-center text-emphasize"
        [class.text-center]="!dense"
        *ngIf="title"
      >
        {{ title }}
      </div>
      <div
        class="flex-1 display-inline-flex justify-content-end align-items-center"
        *ngIf="isLoggedIn"
      >
        <ng-content></ng-content>
        <button
          class="unstyled ml-1 text-emphasize"
          [matMenuTriggerFor]="menu"
          data-test="main-menu"
        >
          <mat-icon aria-hidden="false" aria-label="Menu" class="middle"
            >menu</mat-icon
          >
        </button>
        <mat-menu #menu="matMenu">
          <ng-container *ngIf="auth.userData$ | async as userData">
            <span mat-menu-item [disabled]="true"
              >Subscription status:
              <strong class="text-emphasize">{{
                userData | subscriptionStatus
              }}</strong></span
            >
            <span
              mat-menu-item
              *ngIf="
                isCancelled(userData) && !isExpired(userData.cancellationDate)
              "
              [disabled]="true"
              >Available until:
              {{ userData.cancellationDate | date: 'mediumDate' }}</span
            >
            <span
              mat-menu-item
              *ngIf="isActive(userData) && userData.nextBillDate"
              [disabled]="true"
              >Next payment:
              <strong class="text-emphasize">{{
                userData.nextBillDate | date: 'mediumDate'
              }}</strong></span
            >
            <span
              mat-menu-item
              *ngIf="isActive(userData) && userData.unitPrice"
              [disabled]="true"
              >Amount:
              <strong class="text-emphasize">{{
                userData.unitPrice | currency: 'EUR'
              }}</strong></span
            >
            <a
              mat-menu-item
              *ngIf="isCancelled(userData) || isUnsubscribed(userData)"
              [routerLink]="['/subscription']"
              >Subscribe</a
            >
            <a
              mat-menu-item
              *ngIf="isActive(userData)"
              [routerLink]="['/subscription/manage']"
              data-test="main-menu-manage-subscription"
              >Manage Subscription</a
            >
          </ng-container>
          <button mat-menu-item (click)="signOut()">Sign Out</button>
        </mat-menu>
      </div>
    </ng-container>
  </div>
</header>
<div class="back text-center" *ngIf="hasBack">
  <app-back-button></app-back-button>
</div>
