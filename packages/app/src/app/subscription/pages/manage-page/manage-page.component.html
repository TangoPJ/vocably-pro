<div class="container-xl top">
  <app-header title="Subscription"></app-header>
</div>
<div class="container bottom">
  <ng-container *ngIf="!hasBeenSuccessfullyCancelled">
    <div class="hero" *ngIf="!userData">
      <div class="hero-body text-center">
        <ion-spinner name="dots" class="mr-1"></ion-spinner>Loading data...
      </div>
    </div>
    <div class="hero" *ngIf="userData">
      <div class="hero-body text-center">
        <div class="mb-2">
          Your
          <strong class="text-emphasize">{{ userData.planName }}</strong> status
          is
          <strong class="text-emphasize">{{
            userData | subscriptionStatus
          }}</strong
          >.
          <ng-container
            *ngIf="isCancelled(userData) && userData.cancellationDate"
            >The subscription is active due
            <strong class="text-emphasize">{{
              userData.cancellationDate | date: 'mediumDate'
            }}</strong></ng-container
          >
          <ng-container
            *ngIf="
              isActive(userData) && userData.unitPrice && userData.nextBillDate
            "
            ><br />The next payment is due on
            <strong class="text-emphasize">{{
              userData.nextBillDate | date: 'mediumDate'
            }}</strong
            >. Amount:
            <strong class="text-emphasize">{{
              userData.unitPrice | currency: 'EUR'
            }}</strong
            >.</ng-container
          >
        </div>
        <button
          class="button block mb-1"
          (click)="updatePaymentMethod(userData)"
          data-test="update-payment-method"
        >
          Update Payment Method
        </button>
        <button
          class="button outline block"
          (click)="cancelSubscription(userData)"
          data-test="cancel-subscription"
        >
          Cancel Subscription
        </button>
      </div>
    </div>
  </ng-container>
  <div
    class="hero"
    *ngIf="hasBeenSuccessfullyCancelled"
    data-test="cancellation-success"
  >
    <div class="hero-body text-center">
      <div class="mb-1">
        <span class="big-icon"
          ><mat-icon
            aria-hidden="false"
            aria-label="Done"
            class="text-primary"
            inline="true"
            >check_circle</mat-icon
          ></span
        >
      </div>
      <div class="mb-1">The subscription has been successfully cancelled.</div>
      <a [routerLink]="['/']" data-test="return-to-dashboard"
        >Return to dashboard</a
      >
    </div>
  </div>
</div>
